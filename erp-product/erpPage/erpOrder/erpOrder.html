<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=7">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>小竹熊云科技</title>
  <script src="../../static/js/template.js"></script>
  <script src="../../static/js/jquery-1.8.3.min.js"></script>
  <script src="/static/js/json2.js"></script>
  <link rel="stylesheet" href="../../static/css/base.css">
  <link href="./erpOrder.css" rel="stylesheet" type="text/css" />

</head>

<body>
  <div class="erpOrderBox">
    <!-- 头部 -->
    <div class="toplauotBox">
      <div class="toplauot">
        <div class="left">
          <img src="../../static/images/logo.png" alt="">
          <div class="titleBox">
            <div class="chTitle">
              小竹熊订单同步管理
            </div>
            <br>
            <div class="enTitle">
              Shenzhen Little Bamboo Bear Technology co.,Ltd.
            </div>
          </div>
        </div>
        <div class="right">
          <div class="shouyeBox ">
            <div class=" userImg">
              <img class="homeIcon" src="../../static/images/erpHomeIcon.png" alt="">
            </div>
            <span class="homeText" onclick="toHome()">首页</span>
          </div>
          <div class="shouyeBox ">
            <div class=" userImg">
              <img class="homeIcon" src="../../static/images/activeSampleIcon.png" alt="">
            </div>
            <span class="sampleText">
              我的订单
            </span>
          </div>
          <!-- <div class="loginBtn" @click="toLogins">登录系统</div> -->
          <div class="shouyeBox ">
            <div class="userImg">
              <img class="homeLogo" src="../../static/images/logo.png" alt="">
            </div>
            <span class="signOut" onclick="signOut()">退出</span>
          </div>
        </div>
      </div>
    </div>
    <div id="myTable">
      <!-- 条件搜索区 -->
      <div class="searchBox">
        <form action="">
          <ul>
            <li>
              <p>关键查询：</p> <input id="keyword" type="text" placeholder="输入关键字">
            </li>
            <li>
              <p>来源：</p> <select id="orderFrom">
                <option value="全部">全部</option>
                <option value="Hall">展厅</option>
                <option value="LittleBear">小竹熊</option>
              </select>
            </li>
            <li>
              <p>订单类型：</p> <select id="orderType">
                <option value="全部">全部</option>
                <option value="Sample">择样</option>
                <option value="CompanySample">找样</option>
                <option value="ShareOrder">客户订单</option>
              </select>
            </li><br>
            <li>
              <p>订单编号：</p> <input id="orderNumber" type="text">
            </li>
            <li>
              <p>时间：</p>
              <input type="date" id="startCreatetime" max="">-
            </li>
            <li>
              <input type="date" id="endCreatetime" max="">
            </li>
            <li style="width: 100px;">
              <p class="btnP" onclick="handelSearch()">搜索</p>

            </li>
          </ul>
        </form>
      </div>
      <!-- table表格区 -->
      <div class="tableBox">
        <table id="example" class="display" style="width:100%">
          <thead>
            <tr>
              <th class="text-center">选择</th>
              <th class="text-center">订单来源</th>
              <th class="text-center">订单类型</th>
              <th class="text-center">客户</th>
              <th class="text-center">本次代号</th>
              <th class="text-center">订单数量</th>
              <th class="text-center">订单编号</th>
              <th class="text-center">订单备注</th>
              <th class="text-center thDete">
                <div class="thTxt"> 订单时间</div>
                <div class="triangle">
                  <p onclick="topDete()" class="topS"></p>
                  <p onclick="bottomDete()" class="btoS"></p>
                </div>

              </th>
              <th class="text-center">订单明细</th>
            </tr>
          </thead>
          <tbody id="tbodyData">
          </tbody>
        </table>
        <!-- 二维码下载 -->
        <div class="qr">
          <div class="qrImg">
            <img src="../../static/images/ErWeiMa.png" alt="">
          </div>
          <p>扫码下载</p>
          <p>小竹熊APP</p>
        </div>
      </div>
      <!-- 分页 -->
      <div class="page">
        <ul class="pagination"></ul>
        <input type="hidden" id="currentPage" name="currentPage" value="1"></input>
        <input type="hidden" id="totalPage" value="54"></input>
      </div>
    </div>
  </div>

</body>

</html>


<script>


  var url = "http://139.9.71.135:8096"
  // var userToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJMaXR0bGVCZWFyIiwianRpIjoiNjUwY2NhNTMtYzk5YS00M2M5LWJiMWEtNTcyZGQzNDY5YTRjIiwiaWF0IjoxNjE4MjIwODU3LCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9uYW1lIjoiMTc2MDMwMzM0NTgiLCJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy9zeXN0ZW0iOiJQQyIsImh0dHA6Ly9zY2hlbWFzLnhtbHNvYXAub3JnL3dzLzIwMDUvMDUvaWRlbnRpdHkvY2xhaW1zL3NpZCI6ImU2Yzg5ODllLTUyMGEtNGEyOS05Y2Y1LTAwZDAyNmVmZDBhMiIsIm5iZiI6MTYxODIyMDg1NywiZXhwIjoxNjE4MzA3MjU3LCJpc3MiOiJMaXR0bGVCZWFyIiwiYXVkIjoiTGl0dGxlQmVhciJ9.PpBz-nmKoqz5ZVlRY9x2H8nA1Nm7iQy8h26CB9NfSGs"
  var userToken;
  //初始化
  var data = {
    orderFrom: "全部",
    orderType: "全部",
    skipCount: 1,
    maxResultCount: 10,
    sortOrder: 1,
    sortType: 2
  }
  var orderList = [];
  $(document).ready(function () {
    var token = window.localStorage.getItem("token")
    if (token) {
      userToken = token
      getSampleOrderERPPage()
      console.log("存在");
    } else {
      console.log("没有");
      window.location.href = "../erpHome/erpHome.html"
    }
  })

  // 请求列表
  function getSampleOrderERPPage() {
    $.ajax({
      type: "post",
      url: url + "/api/SampleOrderERPPage",
      data: JSON.stringify(data),
      headers: {
        Utoken: userToken//此处放置请求到的用户token
      },
      contentType: "application/json; charset=utf-8",
      success: function (res) {
        if (res.result.code === 200) {
          orderList = res.result.item.items;
          getTable(res.result.item.items)
        }
        console.log(res, "成功的回调");

      }
    });
  }
  // 渲染列表数据
  function getTable(list) {
    var tbodyData = document.getElementById('tbodyData');
    $("#tbodyData").empty();
    for (var i = 0; i < list.length; i++) {
      var html = ""
      switch (list[i].orderType) {
        case "Sample":
          list[i].orderTypeValue = "择样"
          break;
        case "CompanySample":
          list[i].orderTypeValue = "找样"
          break;
        case "ShareOrder":
          list[i].orderTypeValue = "客户订单"
          break;
        default:
          list[i].orderTypeValue = "--"
          break;
      }
      switch (list[i].hall_na) {
        case " ":
          list[i].hall_naValue = "--"
          break;
        default:
          list[i].hall_naValue = list[i].hall_na
      }

      html += " <tr>" + "<td>" + "</td>" + "<td>" + list[i].hall_naValue + "</td>" + " <td > " + list[i].orderTypeValue + "</td > " +
        "<td>" + list[i].toCompanyName + "</td>" + "<td>" + list[i].the_nu + "</td>" +
        "<td>" + list[i].orderCount + "</td>" + "<td>" + list[i].number + "</td>" +
        "<td>" + list[i].remark + "</td>" + "<td>" + list[i].happenDate + "</td>" +
        "<td><span onclick='handeldetails(" + i + ") '>点击查看</span></td></tr>"
      $("#tbodyData").append(html);
    }
  }

  // 时间排序
  function topDete() {
    data.sortOrder = 2
    data.skipCount = 1;
    getSampleOrderERPPage()
  }
  function bottomDete() {
    data.sortType = 1
    data.skipCount = 1;
    getSampleOrderERPPage()

  }

  // function sortChange(column) {
  //   this.sortOrder = 2;
  //   switch (column.order) {
  //     case "descending": // 降序
  //       this.sortType = 1;
  //       break;
  //     case "ascending": // 升序
  //       this.sortType = 2;
  //       break;
  //     default:
  //       this.sortOrder = null;
  //       this.sortType = null;
  //       break;
  //   }
  //   this.currentPage = 1;
  // }
  //搜索
  function handelSearch() {
    if ($("#keyword").val()) data.keyword = $("#keyword").val();
    if ($("#orderNumber").val()) data.orderNumber = $("#orderNumber").val();
    if ($("#orderFrom").val()) data.orderFrom = $("#orderFrom").val();
    if ($("#orderType").val()) data.orderType = $("#orderType").val();
    if ($("#startCreatetime").val()) data.startTime = $("#startCreatetime").val();
    if ($("#endCreatetime").val()) data.endTime = $("#endCreatetime").val();

    console.log(data);
    getSampleOrderERPPage()

  }
  //退出
  function signOut() {
    window.localStorage.clear()
    window.location.href = "../erpLogin/erpLogin.html"
  }
  //点击跳转
  function handeldetails(index) {
    for (var i = 0; i < orderList.length; i++) {
      if (index === i) {
        var orderNumber = orderList[i].orderNumber
        var orderType = orderList[i].orderType
        window.localStorage.setItem("orderNumber", orderNumber);
        window.localStorage.setItem("orderType", orderType);
        window.location.href = "../erpOrderDetails/erpOrderDetails.html"
      }
    }
  }

</script>
<script type="text/javascript">
  //日期设置，不可选择今日之后的日期
  $(function () {
    var now = new Date();
    var year = now.getFullYear();
    var month = now.getMonth() + 1 < 10 ? "0" + (now.getMonth() + 1)
      : (now.getMonth() + 1);
    var day = now.getDate() < 10 ? "0" + now.getDate() : now.getDate();
    $("#startCreatetime").attr("max", year + "-" + month + "-" + day);
    $("#endCreatetime").attr("max", year + "-" + month + "-" + day);
  })
  $().ready(function () {
    var curPage = $("#currentPage").val();
    var last = $("#totalPage").val();
    var page = Math.ceil(curPage / 10);
    //调用绘制分页样式函数
    draw(page, curPage);

    //绑定点击页码事件
    $(document).on("click", ".pagination li a", function () {
      var str = $(this).html();
      if (!isNaN(str)) {
        //移除之前的active
        $(".pagination li a").removeClass("active");
        $(this).attr("class", "active");
        $("#currentPage").val(str);
      }
    });
    //绑定下一页点击事件
    $(document).on("click", "#nextPage", function () {
      var num = $(".active").html();
      var curPage = $("#currentPage").val();
      var last = $("#totalPage").val();
      var page = Math.ceil((parseInt(num)) / 10);

      if (num < page * 10 && num != last) {
        //移除之前的active
        $(".pagination li a").removeClass("active");
        $("#" + (parseInt(num) + 1) + "").attr("class", "active");
        //$(".pagination li a[text="+(parseInt(num)+1)+"]").attr("class","active");//jQ1.6支持
        $("#currentPage").val(parseInt(num) + 1);
      } else if (num == page * 10 && num != last) {
        //清空之前的数据
        $(".pagination").html("");
        draw(page + 1, (parseInt(num) + 1));
      }
      getSampleOrderERPPage()
    })

    //绑定上一页点击事件
    $(document).on("click", "#previousPage", function () {
      var num = $(".active").html();
      var curPage = $("#currentPage").val();
      var last = $("#totalPage").val();
      var page = Math.ceil((parseInt(num)) / 10);
      if (num <= page * 10 && num != (page - 1) * 10 + 1) {
        //移除之前的active
        $(".pagination li a").removeClass("active");
        $("#" + (parseInt(num) - 1) + "").attr("class", "active");
        //$(".pagination li a[text="+(parseInt(num)+1)+"]").attr("class","active");//jQ1.6支持
        $("#currentPage").val(parseInt(num) - 1);
      } else if (num == (page - 1) * 10 + 1 && num != 1) {
        //清空之前的数据
        $(".pagination").html("");
        draw(page - 1, (parseInt(num) - 1));
      }
      getSampleOrderERPPage()
    })

    //绘制页面分页样式
    function draw(page, curPage) {
      //页面中的当前页
      var page = page;
      //后台传过来的页数
      var curPage = curPage;
      //后台传过来的总页数
      var datas = $("#totalPage").val();
      //每页显示多少条数据
      var pageSize = 10;
      //在网页中一共要分多少页
      var totalPage = Math.floor((datas - 1) / pageSize + 1);
      var liStr = "<li><a id='previousPage' href='#'>«</a></li>";
      $("#currentPage").val(curPage);
      if (page <= totalPage) {
        if (datas <= 10) {
          for (i = 1; i <= datas; i++) {
            //为当前页增加样式
            var active = "";
            if (i == curPage) {
              active = " class='active' ";
            }
            liStr += " <li><a id=" + i + " " + active + " href='#'>" + i + "</a></li>"
          }
        } else {
          var start = pageSize * (page - 1) + 1;
          var end = page * pageSize;
          if (page == totalPage) {
            for (i = start; i <= datas; i++) {
              //为当前页增加样式
              var active = "";
              if (i == curPage) {
                active = " class='active' ";
              }
              liStr += " <li><a id=" + i + " " + active + " href='#'>" + i + "</a></li>"
            }
          } else {
            for (i = start; i <= end; i++) {
              //为当前页增加样式
              var active = "";
              if (i == curPage) {
                active = " class='active' ";
              }
              liStr += " <li><a id=" + i + " " + active + " href='#'>" + i + "</a></li>"
            }
          }
        }
      }
      liStr += "<li><a id='nextPage' href='#'>»</a></li>";
      $(".pagination").append(liStr);
    }
  })
</script>